from nginx:1.11.10-alpine
ARG IDNEST_INTERNAL_PORT
ARG INGRESS_INTERNAL_PORT
ARG PREMISER_INTERNAL_PORT
ARG MATERIALSUITE_ENDPOINT_INTERNAL_PORT
ARG ACQ_INTERFACE_INTERNAL_PORT
ARG LISTEN="8080"
ARG REFRESH="10s"
ARG TIMEOUT="30"
ARG MAX_FSIZE="20m"
ENV LISTEN=$LISTEN
ENV REFRESH=$REFRESH
ENV TIMEOUT=$TIMEOUT
ENV MAX_FSIZE=$MAX_FSIZE
ENV IDNEST_INTERNAL_PORT=$IDNEST_INTERNAL_PORT
ENV INGRESS_INTERNAL_PORT=$INGRESS_INTERNAL_PORT
ENV PREMISER_INTERNAL_PORT=$PREMISER_INTERNAL_PORT
ENV MATERIALSUITE_ENDPOINT_INTERNAL_PORT=$MATERIALSUITE_ENDPOINT_INTERNAL_PORT
ENV ACQ_INTERFACE_INTERNAL_PORT=${ACQ_INTERFACE_INTERNAL_PORT}

RUN rm /etc/nginx/conf.d/*
COPY proxy.template /etc/nginx/conf.d/
RUN envsubst '$$ACQ_INTERFACE_INTERNAL_PORT $$IDNEST_INTERNAL_PORT $$INGRESS_INTERNAL_PORT $$PREMISER_INTERNAL_PORT $$MATERIALSUITE_ENDPOINT_INTERNAL_PORT $$LISTEN $$REFRESH $$TIMEOUT $$MAX_FSIZE' < /etc/nginx/conf.d/proxy.template > /etc/nginx/conf.d/proxy.conf
RUN mkdir /www/
COPY www/ /www/
